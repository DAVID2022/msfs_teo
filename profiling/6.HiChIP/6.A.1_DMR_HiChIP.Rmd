---
title: "DMR and HiChIP"
output: html_notebook
author: Jinliang Yang
date: 05-22-2019
---


```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_knit$set(root.dir=normalizePath('../../')) 
#library(tidyverse)
```

# DMR and genomic features

```{r}

```






## DMR

```{r}
dmr <- read.delim("data/all_DMRs_03052019.txt", header=TRUE)
table(dmr$Compare)

## Teosinte and Maize DMR
tm <- subset(dmr, Compare %in% "Teosinte/Maize")
tm$bp <- abs(tm$stop - tm$start)

hist(log10(tm$bp), breaks = 100, col="#eed5b7", main="DMR ", xlab="log10(bp)")
abline(v=median(log10(tm$bp)), lty=2, lwd=2, col="red")
median(tm$bp) # 315
mean(tm$bp) #436

```

# HiChIP Results


```{r}
hichip <- read.table("data/hichipper_interation.txt", header=TRUE)

sum(hichip$Chr_1 == hichip$Chr_2)
#which(hichip$Chr_1 != hichip$Chr_2)

hichip$len1 <- hichip$E1 - hichip$S1
hichip$len2 <- hichip$E2 - hichip$S2


### The length of the interaction sites
l <- c(hichip$len1, hichip$len2)
hist(log10(l), breaks = 100, col="#eed5b7", main="Length the interaction sites", xlab="Log10(bp)")
abline(v=median(log10(l)), lty=2, lwd=2, col="red")
median(l) 
mean(l)

### The distance of the two interaction sites
hichip$dis <- (hichip$S2 + hichip$E2)/2 - (hichip$S1 + hichip$E1)/2
d <- hichip$dis
hist(log10(d), breaks = 100, col="#eed5b7", main="Distance of the two interaction sites", xlab="Log10(bp)")
abline(v=median(log10(d)), lty=2, lwd=2, col="red")
median(d) 
mean(d)

```




## Circos plot:

```{r}
#install.packages('BioCircos')
library(BioCircos)
# https://cran.r-project.org/web/packages/BioCircos/vignettes/BioCircos.html

## Create maize genome
agpv4 = list("chr1" = 307041717,
        "chr2" = 244442276,
        "chr3" = 235667834,
        "chr4" = 246994605,
        "chr5" = 223902240,
        "chr6" = 174033170,
        "chr7" = 182381542,
        "chr8" = 181122637,
        "chr9" = 159769782,
        "chr10" = 150982314)

BioCircos(genome = agpv4, genomeFillColor = c("tomato2", "darkblue"))


hichip <- subset(hichip, Chr_1 %in% 1:10)

links_chromosomes_1 = paste0("chr", as.numeric(as.character(hichip$Chr_1))) # Chromosomes on which the links should start
links_chromosomes_2 = paste0("chr", as.numeric(as.character(hichip$Chr_2))) # Chromosomes on which the links should end

links_pos_1 = hichip$S1
links_pos_2 = hichip$S2
#links_labels = c("Link 1", "Link 2", "Link 3")

tracklist = BioCircosBackgroundTrack("myBackgroundTrack", minRadius = 0, maxRadius = 0.9,
  borderSize = 0, fillColors = "#EEFFEE")  

tracklist = tracklist + BioCircosLinkTrack('myLinkTrack', links_chromosomes_1, links_pos_1,
  links_pos_1 + 500, links_chromosomes_2, links_pos_2, links_pos_2 + 7500, width="0.001em",
  maxRadius = 0.9)

BioCircos(tracklist, genome = agpv4, genomeFillColor = "PuOr",
  chrPad = 0.02, displayGenomeBorder = FALSE, yChr =  FALSE,
  genomeTicksDisplay = FALSE,  genomeLabelTextSize = "8pt", genomeLabelDy = 0)
```

